<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>在RawImage上鼠标点在屏幕上发生偏移的问题</title>
      <link href="/2024/03/09/%E5%9C%A8RawImage%E4%B8%8A%E9%BC%A0%E6%A0%87%E7%82%B9%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%8F%91%E7%94%9F%E5%81%8F%E7%A7%BB%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2024/03/09/%E5%9C%A8RawImage%E4%B8%8A%E9%BC%A0%E6%A0%87%E7%82%B9%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%8F%91%E7%94%9F%E5%81%8F%E7%A7%BB%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="问题简述"><a href="#问题简述" class="headerlink" title="问题简述"></a>问题简述</h1><p>实现3D人物使用RawImage映射到UI上时，鼠标悬浮在人物的身上时出现UI的效果。<br>但是发现鼠标点不到正确的人物部位，鼠标在UI上的坐标相比在屏幕上的坐标发生了偏移。</p><h1 id="问题解决简述"><a href="#问题解决简述" class="headerlink" title="问题解决简述"></a>问题解决简述</h1><p><strong>使用RectTransformUtility.ScreenPointToLocalPointInRectangle()方法将屏幕坐标转换成UGUI的坐标</strong></p><blockquote><p>一般使用Physics.Raycast()时是ray &#x3D; MainCamera.ScreenPointToRay(Input.mousePosition)</p></blockquote><blockquote><p>但是3D物体要投射到UI上时，就多了一步，先将Input.mousePosition转UGUI的坐标，再用ScreenPointToRay()</p></blockquote><blockquote><p>注意：<br>①RawImage的Width和Height必须和创建的RenderTexture的Size一致。<br>②如果Canvas的Render Mode是overlay则RectTransformUtility.ScreenPointToLocalPointInRectangle()的关于相机的参数可以写null<br>③RawImage的Pivot为了方便设置成0。Pivot是控制UI的中心点，设置成0则UI的（0,0）点在UI的左下角，方便计算。</p></blockquote><h1 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h1><h2 id="1、使用RawImage将3D人物投射到UI上"><a href="#1、使用RawImage将3D人物投射到UI上" class="headerlink" title="1、使用RawImage将3D人物投射到UI上"></a>1、使用RawImage将3D人物投射到UI上</h2><p>1、创建一个Canvas，在其下创建一个RawImage，然后在Assets下创建一个Render Texture。使RawImage的Width和Height和创建的RenderTexture的Size一致，将Render Texture赋给RawImage。<br><img src="/2024/03/09/%E5%9C%A8RawImage%E4%B8%8A%E9%BC%A0%E6%A0%87%E7%82%B9%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%8F%91%E7%94%9F%E5%81%8F%E7%A7%BB%E7%9A%84%E9%97%AE%E9%A2%98/Picture01.png" alt="在这里插入图片描述"><br><img src="/2024/03/09/%E5%9C%A8RawImage%E4%B8%8A%E9%BC%A0%E6%A0%87%E7%82%B9%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%8F%91%E7%94%9F%E5%81%8F%E7%A7%BB%E7%9A%84%E9%97%AE%E9%A2%98/Picture02.png" alt="在这里插入图片描述"></p><p><img src="/2024/03/09/%E5%9C%A8RawImage%E4%B8%8A%E9%BC%A0%E6%A0%87%E7%82%B9%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%8F%91%E7%94%9F%E5%81%8F%E7%A7%BB%E7%9A%84%E9%97%AE%E9%A2%98/Picture03.png" alt="在这里插入图片描述"><br>2、创建一个Camera来专门看人物，CullingMask选择创建的Model层，将ModelShow赋给Target Texture。<br><img src="/2024/03/09/%E5%9C%A8RawImage%E4%B8%8A%E9%BC%A0%E6%A0%87%E7%82%B9%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%8F%91%E7%94%9F%E5%81%8F%E7%A7%BB%E7%9A%84%E9%97%AE%E9%A2%98/Picture04.png" alt="在这里插入图片描述"><br>3、将人物的Layer也选为Model<br><img src="/2024/03/09/%E5%9C%A8RawImage%E4%B8%8A%E9%BC%A0%E6%A0%87%E7%82%B9%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%8F%91%E7%94%9F%E5%81%8F%E7%A7%BB%E7%9A%84%E9%97%AE%E9%A2%98/Picture05.png" alt="在这里插入图片描述"></p><h2 id="2、使用RectTransformUtility-ScreenPointToLocalPointInRectangle-方法解决鼠标偏移"><a href="#2、使用RectTransformUtility-ScreenPointToLocalPointInRectangle-方法解决鼠标偏移" class="headerlink" title="2、使用RectTransformUtility.ScreenPointToLocalPointInRectangle()方法解决鼠标偏移"></a>2、使用RectTransformUtility.ScreenPointToLocalPointInRectangle()方法解决鼠标偏移</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RayCastModel</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> isStart = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Vector3 screenPoint;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> Vector2 localPoint;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RectTransform rect;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Transform&gt; PointsList = <span class="keyword">new</span> List&lt;Transform&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Transform labels;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Camera modelCamera;</span><br><span class="line"></span><br><span class="line">    Ray ray;</span><br><span class="line">    RaycastHit raycastHit;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        labels = GameObject.Find(<span class="string">&quot;UICanvas/Labels&quot;</span>).transform;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.S))</span><br><span class="line">        &#123;</span><br><span class="line">            isStart = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.D))</span><br><span class="line">        &#123;</span><br><span class="line">            isStart = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isStart == <span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">//获取屏幕坐标</span></span><br><span class="line">            screenPoint = Input.mousePosition;</span><br><span class="line">        <span class="comment">//屏幕坐标转UGUI坐标</span></span><br><span class="line">            <span class="keyword">if</span> (RectTransformUtility.ScreenPointToLocalPointInRectangle(rect, screenPoint, <span class="literal">null</span>, <span class="keyword">out</span> localPoint))</span><br><span class="line">            &#123;</span><br><span class="line">                localPoint = <span class="keyword">new</span> Vector2(localPoint.x, localPoint.y);</span><br><span class="line"> </span><br><span class="line">                ray = modelCamera.ScreenPointToRay(localPoint);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (Physics.Raycast(ray, <span class="keyword">out</span> raycastHit, <span class="number">1000</span>, <span class="number">1</span> &lt;&lt; <span class="number">8</span>))</span><br><span class="line">                &#123;                    </span><br><span class="line">                    Debug.DrawLine(modelCamera.transform.position, raycastHit.collider.transform.position, Color.blue);</span><br><span class="line">                    <span class="keyword">if</span> (PointsList.Contains(raycastHit.collider.transform))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (raycastHit.collider.transform.name == <span class="string">&quot;LeftPoint&quot;</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            labels.GetChild(<span class="number">0</span>).transform.position = screenPoint;</span><br><span class="line">                            labels.GetChild(<span class="number">0</span>).Find(<span class="string">&quot;Image/Text&quot;</span>).GetComponent&lt;Text&gt;().text = <span class="string">&quot;左手&quot;</span>;</span><br><span class="line">                            labels.GetChild(<span class="number">0</span>).gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (raycastHit.collider.transform.name == <span class="string">&quot;RightPoint&quot;</span>)</span><br><span class="line">                        &#123;</span><br><span class="line">                            labels.GetChild(<span class="number">0</span>).transform.position = screenPoint;</span><br><span class="line">                            labels.GetChild(<span class="number">0</span>).Find(<span class="string">&quot;Image/Text&quot;</span>).GetComponent&lt;Text&gt;().text = <span class="string">&quot;右手&quot;</span>;</span><br><span class="line">                            labels.GetChild(<span class="number">0</span>).gameObject.SetActive(<span class="literal">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; labels.childCount; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        labels.GetChild(i).gameObject.SetActive(<span class="literal">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>编辑器</title>
      <link href="/2024/03/07/%E7%BC%96%E8%BE%91%E5%99%A8/"/>
      <url>/2024/03/07/%E7%BC%96%E8%BE%91%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>unitypackage：<a href="SwitchProjectsEditor.unitypackage">下载链接</a></p><p>示例图片：<img src="/2024/03/07/%E7%BC%96%E8%BE%91%E5%99%A8/image.png" alt="图片1"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>作品展示</title>
      <link href="/2024/03/06/%E4%BD%9C%E5%93%81%E9%93%BE%E6%8E%A5/"/>
      <url>/2024/03/06/%E4%BD%9C%E5%93%81%E9%93%BE%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<p>视频合集项目：<a href="https://hyf1113.github.io/VideosCollections/">链接地址</a></p><p>AR展示项目：<a href="/2024/03/06/AR%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/">链接地址</a></p><p>编辑器：<a href="/2024/03/07/%E7%BC%96%E8%BE%91%E5%99%A8/">链接地址</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>AR展示项目</title>
      <link href="/2024/03/06/AR%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/"/>
      <url>/2024/03/06/AR%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<p>安卓APK下载：<a href="https://pan.baidu.com/s/1NZ41eXEhaBcheTOx5U_XnQ?pwd=1pib">APK下载</a><br>模型示例图片：<img src="/2024/03/06/AR%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/BaChongShenZi.png" alt="图片1"><br><img src="/2024/03/06/AR%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/DiAoNa.png" alt="图片2"><br><img src="/2024/03/06/AR%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/FeiXieEr.png" alt="图片3"><br><img src="/2024/03/06/AR%E5%B1%95%E7%A4%BA%E9%A1%B9%E7%9B%AE/TuoMa.png" alt="图片4"></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
